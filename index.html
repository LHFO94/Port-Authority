<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hello World</title>
  <link rel="stylesheet" type="text/css" href="style.css">

</head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>
  <script src="utils.js"></script>
  <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js></script>
  <script type="text/javascript">

    //Aliases
    let Container = PIXI.Container,
    autoDetectRenderer = PIXI.autoDetectRenderer,
    loader = PIXI.Loader.shared,
    TextureCache = PIXI.utils.TextureCache,
    resources = PIXI.Loader.shared.resources,
    Sprite = PIXI.Sprite;

    //Create the stage and renderer
    let stage = new Container(),
    renderer = autoDetectRenderer(256, 256);
    renderer.backgroundColor = "0x0492C2";    
    document.body.appendChild(renderer.view);

    //Load an image and call the `setup` function
    loader
    .add("images/tilesheet.png")
    .on("progress", loadProgressHandler)
    .load(setup);

    function loadProgressHandler(loader, resource) {
    //Display the file `url` currently being loaded
      console.log(`loading: ${resource.url}`);
      //Display the percentage of files currently loaded
      console.log(`progress: ${loader.progress}`);
    }

    function setup() {

      let numberOfShips = 5,
          spacing = 200,
          xOffset = 150;

      for (let i = 0; i < numberOfShips; i++) {
        //Create the sprite, add it to the stage and render it
        let ship1 = new Sprite(frame("images/tilesheet.png", 0,0,20,100))
        let ship2 = new Sprite(frame("images/tilesheet.png", 30,0,25,130))
        let ship3 = new Sprite(frame("images/tilesheet.png", 230,0,25,115))
        let ships = [ship1, ship2, ship3]
        let randomShip = getRandomInt(3);
        let ship = ships[randomShip];

        let x = spacing * i + xOffset;
        let y = getRandomInt(renderer.height);
        let rotation = math.random()

        ship.x = x
        ship.y = y
        ship.vx = x
        ship.vy = y
        ship.rotation = rotation
     
        console.log(`${i} ${randomShip} ${ship.x}`);
        stage.addChild(ship);
      }
      renderer.render(stage);

    }

    function gameLoop () {

    }

    function frame(source, x, y, width, height) {

      var texture = undefined,
      imageFrame = undefined;

      //If the source is a string, it's either a texture in the
      //cache or an image file
      if (typeof source === "string") {
        if (TextureCache[source]) {
          texture = new PIXI.Texture(TextureCache[source]);
        }
      }

      //If the `source` is a texture,  use it
      else if (source instanceof this.Texture) {
          texture = new PIXI.Texture(source);
        }
      if (!texture) {
        throw new Error("Please load the " + source + " texture into the cache.");
      } else {

        //Make a rectangle the size of the sub-image
        imageFrame = new PIXI.Rectangle(x, y, width, height);
        texture.frame = imageFrame;
        return texture;
      }
    }

    function getRandomInt(max) {
      return Math.floor(Math.random() * max);
    }

    // event listener for window resizing
    window.addEventListener("resize", event => {
      scaleToWindow(renderer.view)
    })

  </script>
</body>
</html>